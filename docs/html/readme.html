

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>1. README &mdash; Cython Examples 2021 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="2. Overview" href="overview.html" />
    <link rel="prev" title="Cython Examples" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Cython Examples
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">1. README</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#more-info">1.1. More info</a></li>
<li class="toctree-l2"><a class="reference internal" href="#old">1.2. OLD</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cython-example">1.3. Cython Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="#example-usage">1.4. Example Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="#some-issues-to-resolve">1.5. Some Issues to resolve</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="overview.html">2. Overview</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Cython Examples</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li><span class="section-number">1. </span>README</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/readme.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="readme">
<h1><span class="section-number">1. </span>README<a class="headerlink" href="#readme" title="Permalink to this headline">¶</a></h1>
<p>2021-01-30 TODO List</p>
<ul class="simple">
<li><p>[ ] update docs for <code class="code docutils literal notranslate"><span class="pre">.nojekyll</span></code> for gh pages issues.</p></li>
<li><p>[ ] provide info on how to locally compile pyx file, and use with ipython</p></li>
<li><p>[ ] provide info on how to compile/build pyx file for vitual envrionment</p></li>
<li><p>[ ] provide info on how to compile c++ lib (for header/.so or .a) usage
on linux/mac, and how it links to pyx installation</p></li>
<li><p>[ ] provide info on how to resolve circular install, namely, if requiring
python buildings only, use <code class="code docutils literal notranslate"><span class="pre">setup.py</span></code> to build and compile c++ then
cython and create python package locally / or for virtual machine,
versus compiling and installing c++ library &amp; headers into system
for use with other c++ programs separately from python; so, to ramble on,
Identify the different use cases and provide info on each</p></li>
<li><p>[ ] test docs generation in docs folder and linking github pages
directly to docs folder without needing to make another branch for documentation</p></li>
<li><p>[ ] consider baseline <code class="code docutils literal notranslate"><span class="pre">docs</span></code> folder with base configuration required</p></li>
</ul>
<p><a class="reference external" href="https://evgenyslab.github.io/cython_examples/">Check out the docs!</a></p>
<p>2021-01-27 - Generating Sphinx side by side with Doxygen</p>
<ul class="simple">
<li><p>run sphinx-quickstart in docs folder, use separate build/source option</p></li>
<li><p>configure the conf.py file in docs/sources</p></li>
<li><p>add rst files to docs/sources</p></li>
<li><p>in doxygen set output dir to doxygen + generate HTML</p></li>
<li><p>See MakeFile and conf.py to see how doxygen is auto generated, and copied into
gh-pages</p></li>
</ul>
<p>TODO: add notes on generating doxy for cython specific project…</p>
<p>Note: if using gh-pages (github pages) use a side-by-side repository
structure to keep track of the branch to push pages, make sure to set
the <code class="docutils literal notranslate"><span class="pre">BUILDDIR</span></code> in the <code class="docutils literal notranslate"><span class="pre">MakeFile</span></code> to the correct relative path, otherwise,
if generating the docs in a nested location, set the build file to
the required location. Please note, the <code class="docutils literal notranslate"><span class="pre">Makefile</span></code> has directive to build
the doxygen structure as well</p>
<p>TODO: might want to add the makefile directive to the labmanual sauces page</p>
<p>In the index rst / or wherever, add relative link to doxygen/index.html to access it</p>
<p>TODO: how to add readme.md as main page in both sphinx/doxygen?</p>
<div class="section" id="more-info">
<h2><span class="section-number">1.1. </span>More info<a class="headerlink" href="#more-info" title="Permalink to this headline">¶</a></h2>
<p>Use Cases:
A. C++ packages that need to used in C++ and Python Application
B. C++ packages that will be exclusively used by Python Applications</p>
<p>Project Structure:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># MIXED STRUCTURE</span>

.
├── docs
│   └── Doxyfile
├── include
│   ├── header1.h
│   └── header2.h
├── pythonpackagename
│   ├── __init__.py
│   └── pythonpackagename.pyx
├── src
│   ├── sourceFile1.cpp
│   └── sourceFile2.cpp
├── tests
│   ├── CMakeLists.txt
│   ├── __init__.py
│   ├── genericTestSuite.cpp
│   └── test_interfacepackage.py
├── CMakeLists.txt
├── LICENSE
├── requirements.txt
├── setup.py
</pre></div>
</div>
<p>Workflows:</p>
<ol class="arabic simple">
<li><p>Develop C++ Library with concurrent tests, until required functionality is met by library.</p>
<ul class="simple">
<li><p>Open Clion Project with SSH into running docker container</p></li>
<li><p>Develop in Clion with remote docker</p></li>
<li><p>Run tests in docker container</p></li>
<li><p>Verify operation</p></li>
</ul>
</li>
<li><p>Write one .pyx cython wrapper for C++ library in <code class="docutils literal notranslate"><span class="pre">python</span></code> folder</p></li>
<li><p>Write and place python tests in <code class="docutils literal notranslate"><span class="pre">tests</span></code> folder side by side with c++ tests</p></li>
</ol>
<p>(at this point, in CLion - all folders should sycn to docker container)</p>
<ol class="arabic simple">
<li><p>SSH into docker container using <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">exec</span> <span class="pre">-it</span> <span class="pre">container_name</span> <span class="pre">zsh</span></code></p></li>
<li><p>(docker) navigate to project folder</p></li>
<li><p>(docker) run <code class="docutils literal notranslate"><span class="pre">python3</span> <span class="pre">setup.py</span> <span class="pre">install</span></code> to install the package into the container’s system python</p></li>
<li><p>(docker) Run python tests <code class="docutils literal notranslate"><span class="pre">python3</span> <span class="pre">tests/testSuite.py</span></code>, verify tests pass (repeat #2-7 as needed)</p></li>
</ol>
<p>Option A:</p>
<ol class="arabic simple">
<li><p>Create <code class="docutils literal notranslate"><span class="pre">Install</span></code> targets in <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> for C++ Library to place compiled binaries in correct system
folder and move headers into system <code class="docutils literal notranslate"><span class="pre">include</span></code>. [This creates install instructions for target systems]</p></li>
</ol>
<p>(<a href="#id1"><span class="problematic" id="id2">**</span></a><em>TODO</em><a href="#id3"><span class="problematic" id="id4">**</span></a>: Bundle python install with CMake Install Instructions)</p>
<ol class="arabic simple">
<li><p>Run standard C++ library install procedure on target system:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir build
<span class="nb">cd</span> build
cmake ..
make
sudo make install
</pre></div>
</div>
<p>Option B:</p>
<ol class="arabic simple">
<li><p>On target system, clone/copy repository (i.e. docker), and run <code class="docutils literal notranslate"><span class="pre">python3</span> <span class="pre">setup.py</span> <span class="pre">install</span></code></p>
<ul class="simple">
<li><p>this will be either in docker container (through ssh), or on a target system</p></li>
<li><p>Alternatively can run <code class="docutils literal notranslate"><span class="pre">pip3</span> <span class="pre">install</span> <span class="pre">.</span></code> for automation.</p></li>
</ul>
</li>
</ol>
</div>
<div class="section" id="old">
<h2><span class="section-number">1.2. </span>OLD<a class="headerlink" href="#old" title="Permalink to this headline">¶</a></h2>
<p>it seems like its possible to run <code class="docutils literal notranslate"><span class="pre">python3</span> <span class="pre">setup</span> <span class="pre">install</span></code> without building any sources; I think its automated
by cython</p>
<p>TODO:</p>
<ul class="simple">
<li><p>[ ] Python unit testing</p></li>
<li><p>[ ] setup.py force c++ build</p></li>
<li><p>[ ] pycharm force setup.py build on console or application run…</p></li>
</ul>
<p>How to structure cython repo to use both clion &amp; pycharm separatel?</p>
<p>How to get cython to build binaries for an environment and make it useable?</p>
<p>i.e. cython package developed concurrently with a python application?</p>
<p>How to setup c++ to run on docker container at the same time as the pycharm?</p>
<ul class="simple">
<li><p>using <code class="docutils literal notranslate"><span class="pre">bin</span></code> in cpp side as build directory - need to configure clion for it…</p></li>
<li><p>I’m not sure if its possible to avoid running setup.py on cythonized code, however I know C++ compiled modules can
be used by python without cython; that might be better</p></li>
<li><p>it seems inescapible to run python setup.py install - but how to make this automated for docker system for any N
sets of python wrapped c++ libraries? How to make sure they are testable? How to develop them?</p></li>
</ul>
<p>Proposal:</p>
<ol class="arabic simple">
<li><p>run docker container</p></li>
<li><p>develop C++ library in <code class="docutils literal notranslate"><span class="pre">sources</span></code> with Clion in ssh docker</p></li>
<li><p>Write python interface <code class="docutils literal notranslate"><span class="pre">.pyx</span></code> for sources in host application</p></li>
<li><p>use script to upload project to container, build &amp; install python package</p>
<ul class="simple">
<li><p>currently testing ssh’ed install… need to fix LD_library_path…
-&gt; note that exporting the LD_LIBRARY_PATH will only work in the connected docker instance…
-&gt; maybe in pycharm starting script need to do export of LD library path to get it to see correctly..</p></li>
</ul>
</li>
</ol>
<p>To run remote testing, could use pycharm to upload with ssh, then ssh into docker and run:</p>
<p><code class="docutils literal notranslate"><span class="pre">python3</span> <span class="pre">setup.py</span> <span class="pre">build_ext</span> <span class="pre">--inplace</span></code></p>
<p>to build the project inplace, then run <code class="docutils literal notranslate"><span class="pre">pythonr3</span> <span class="pre">tests/testSuite.py</span></code> but this has import error :()</p>
<p>NOTE: when using CLion with ssh - it creates a different project folder! Might not be able to run both C++ and python
concurrently in CLion and Pycharm! Develop C++ FIRST, Then close and use Pycharm w/ shh…</p>
</div>
<div class="section" id="cython-example">
<h2><span class="section-number">1.3. </span>Cython Example<a class="headerlink" href="#cython-example" title="Permalink to this headline">¶</a></h2>
<p>This project presents an example of creating a cython (python) wrapper for a
c++ class/library.</p>
<p>To begin, create the following folder structure:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">|-</span> <span class="n">include</span><span class="o">/</span>
    <span class="o">|-</span> <span class="n">myClass</span><span class="o">.</span><span class="n">h</span>  <span class="c1"># place C++ header files here</span>
<span class="o">|-</span> <span class="n">src</span><span class="o">/</span>
    <span class="o">|-</span> <span class="n">myClass</span><span class="o">.</span><span class="n">cpp</span>  <span class="c1"># place C++ source files here</span>
<span class="o">|-</span> <span class="n">python</span><span class="o">/</span>
    <span class="o">|-</span> <span class="n">myClass</span><span class="o">.</span><span class="n">pyx</span>  <span class="c1"># this will be python interface</span>
<span class="o">|-</span> <span class="n">CmakeLists</span><span class="o">.</span><span class="n">txt</span>  <span class="c1"># this will define C++ class compile</span>
<span class="o">|-</span> <span class="n">setup</span><span class="o">.</span><span class="n">py</span>   <span class="c1"># this will define cython wrapper creation &amp; python package</span>
              <span class="c1"># installation</span>
<span class="o">|-</span> <span class="n">requirements</span><span class="o">.</span><span class="n">txt</span>  <span class="c1"># this is the python virtual environment requirements.</span>
<span class="o">|</span> <span class="o">.</span><span class="n">gitignore</span>  <span class="c1"># ingore some byproduct files</span>
</pre></div>
</div>
<p>This example project is built around the use of <code class="docutils literal notranslate"><span class="pre">cmake</span></code> with python virutal
environments to ensure clean builds of custom packages.</p>
<p>The general process flow to create a C++ library and wrap it with python using
cython follows:</p>
<ol class="arabic">
<li><p>Write C++ library in <code class="docutils literal notranslate"><span class="pre">src</span></code> and <code class="docutils literal notranslate"><span class="pre">include</span></code> folders and create <code class="docutils literal notranslate"><span class="pre">CmakeLists.txt</span></code>
that defines compilation of the custom class as a static library</p></li>
<li><p>Wrap the C++ library with python in the <code class="docutils literal notranslate"><span class="pre">python/myClass.pyx</span></code> file by creating
python interfaces for specific class members and functions.</p></li>
<li><p>Compile C++ library with <code class="docutils literal notranslate"><span class="pre">cmake</span></code> and <code class="docutils literal notranslate"><span class="pre">make</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir build
<span class="nb">cd</span> build
cmake ..
make
</pre></div>
</div>
</li>
<li><p>[Optionally - but highly recommended] Create local python virtual environment
with at minimum <code class="docutils literal notranslate"><span class="pre">cython</span></code> package installed. Enable virtual environment before
installing wrapped package.</p></li>
<li><p>Write python package install script <code class="docutils literal notranslate"><span class="pre">setup.py</span></code>.</p></li>
<li><p>Cythonize and install wrapped python package using (<em>in virtual environment</em>):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python setup.py install
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="example-usage">
<h2><span class="section-number">1.4. </span>Example Usage<a class="headerlink" href="#example-usage" title="Permalink to this headline">¶</a></h2>
<p>Once the C++ has been compiled and the cython wrapper generated and installed
(into virtual environment), the following usage example is provided in <code class="docutils literal notranslate"><span class="pre">ipython</span></code>
console:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">myClass</span>

<span class="n">obj</span> <span class="o">=</span> <span class="n">myClass</span><span class="o">.</span><span class="n">PymyClass</span><span class="p">()</span>
<span class="c1"># test getters:</span>
<span class="n">obj</span><span class="o">.</span><span class="n">getInt</span><span class="p">()</span>
<span class="n">obj</span><span class="o">.</span><span class="n">getFloat</span><span class="p">()</span>
<span class="n">obj</span><span class="o">.</span><span class="n">getChar</span><span class="p">()</span>
<span class="n">obj</span><span class="o">.</span><span class="n">getString</span><span class="p">()</span>

<span class="c1"># test setters:</span>
<span class="n">obj</span><span class="o">.</span><span class="n">setInt</span><span class="p">(</span><span class="mi">12398</span><span class="p">)</span>
<span class="n">obj</span><span class="o">.</span><span class="n">setFloat</span><span class="p">(</span><span class="mf">10.312</span><span class="p">)</span>
<span class="n">obj</span><span class="o">.</span><span class="n">setDouble</span><span class="p">(</span><span class="mf">842.129381084170238102489712</span><span class="p">)</span>
<span class="n">obj</span><span class="o">.</span><span class="n">setChar</span><span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">)</span>
<span class="n">obj</span><span class="o">.</span><span class="n">setString</span><span class="p">(</span><span class="s2">&quot;test string&quot;</span><span class="p">)</span>  <span class="c1"># &lt;- WILL NOT WORK</span>
<span class="n">b</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="s2">&quot;test string with bytes&quot;</span><span class="p">,</span> <span class="s2">&quot;UTF-8&quot;</span><span class="p">)</span>  <span class="c1"># UTF-8 or ascii encoding will print out correctly on C++ side; otherwise it will just receive a byte array, which is useful for data such as images.</span>
<span class="n">obj</span><span class="o">.</span><span class="n">setBytes</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="some-issues-to-resolve">
<h2><span class="section-number">1.5. </span>Some Issues to resolve<a class="headerlink" href="#some-issues-to-resolve" title="Permalink to this headline">¶</a></h2>
<p><em>IMPORTANT</em>
The current CMakeLists.txt file creates a Static library object <code class="docutils literal notranslate"><span class="pre">.a</span></code>, this works fine with MacOS compiler, however
when moving to linux, gcc compiler has trouble linking to a static library, therefore the CmakeLists.txt should
change the desigation of the library from <code class="docutils literal notranslate"><span class="pre">STATIC</span></code> to <code class="docutils literal notranslate"><span class="pre">SHARED</span></code> when non-MacOs host is detected.</p>
<p>Next problem is that the compiled shared library in Linux is locaated in the build folder <code class="docutils literal notranslate"><span class="pre">build/*.so</span></code>, however,
when trying to load the class object in python, python says it cannot open the library object.
<a class="reference external" href="https://stackoverflow.com/questions/1099981/why-cant-python-find-shared-objects-that-are-in-directories-in-sys-path">this</a>
suggests that the LD_LIBRARY_PATH should include the <code class="docutils literal notranslate"><span class="pre">.so</span></code> location - need to verify this and check.</p>
<p>SOLUTION:</p>
<ul>
<li><p>updated CMakeLists.txt for Linux to create shared library object (<code class="docutils literal notranslate"><span class="pre">.so</span></code>) in build folder.</p></li>
<li><p>Need to check in linux <code class="docutils literal notranslate"><span class="pre">LD_LIBRARY_PATH</span></code> environment variable - it might be empty.</p></li>
<li><p>Need to add, temporarily the build dir to the <code class="docutils literal notranslate"><span class="pre">LD_LIBRARY_PATH</span></code> variable for python to correctly
link the libraries:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="s1">&#39;$LD_LIBRARY_PATH:path/to/build/folder&#39;</span>
</pre></div>
</div>
</li>
<li><p>string is passed as an array of bytes to python</p></li>
<li><p>not sure if setString works expected bytes but got string..</p></li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="overview.html" class="btn btn-neutral float-right" title="2. Overview" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="index.html" class="btn btn-neutral float-left" title="Cython Examples" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, ENuger.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>